{"id":"agon-04k","title":"Discord rooms: create thread + post via webhook with thread_id","description":"Implement Discord integration for Room creation: create (or reuse) webhook for parent channel (stored in discord_channels); create thread for room; store threadId on room; post messages into thread using webhook endpoint with ?thread_id=...nnDoD:n- New endpoint or interaction handler can create a room threadn- Posting into thread works (webhook thread_id)n- DB is updated with thread + webhook refsn- gate passes","status":"open","priority":2,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-02-04T01:55:34.470323333+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-02-04T01:55:34.470323333+01:00","dependencies":[{"issue_id":"agon-04k","depends_on_id":"agon-3m6","type":"blocks","created_at":"2026-02-04T01:56:32.654243675+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"agon-04k","depends_on_id":"agon-1e3","type":"relates-to","created_at":"2026-02-04T01:57:26.88289332+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"agon-1e3","title":"Rooms (Discord threads) + multi-provider agents","description":"Goal: Introduce a Room abstraction mapped 1:1 to a Discord thread, allow a persona Agent to join many rooms, and support agents using different LLM providers (OpenAI/Anthropic/Gemini) in the same room.nnKey requirements:n- Room == Discord threadn- Webhook reused per parent channel (posts into thread via thread_id)n- Agent is reusable persona and can join many roomsn- Each agent can specify provider+model; turns can mix providersn- History source-of-truth is Discord thread; persist synced history in D1nnDefinition of Done (epic):n- New DB schema supports rooms, room_agents, discord_channels webhooks, provider/model per agentn- Worker can create/start a room thread and orchestrate turns via Queuen- LLM router can call correct provider per agent per turnn- Consumer fetches Discord thread history and syncs to D1n- docs/design.md updated to match","status":"open","priority":1,"issue_type":"epic","owner":"r.krzywaznia@gmail.com","created_at":"2026-02-04T01:54:56.023526961+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-02-04T01:54:56.023526961+01:00","dependencies":[{"issue_id":"agon-1e3","depends_on_id":"agon-5oc","type":"relates-to","created_at":"2026-02-04T01:57:11.630197939+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"agon-1e3","depends_on_id":"agon-3m6","type":"relates-to","created_at":"2026-02-04T01:57:16.714894121+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"agon-1e3","depends_on_id":"agon-7fz","type":"relates-to","created_at":"2026-02-04T01:57:21.797550977+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"agon-1e3","depends_on_id":"agon-04k","type":"relates-to","created_at":"2026-02-04T01:57:26.880366005+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"agon-1e3","depends_on_id":"agon-81x","type":"relates-to","created_at":"2026-02-04T01:57:31.961521922+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"agon-1e3","depends_on_id":"agon-4rg","type":"relates-to","created_at":"2026-02-04T01:57:37.052271616+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"agon-3m6","title":"DB migration: arenas -\u003e rooms; add discord_channels + agent provider/model","description":"Implement Drizzle schema + migrations: rename arenas-\u003erooms, arena_agents-\u003eroom_agents, add discord_channels table for webhook storage per parent channel, update messages table to include discord_message_id + thread_id for sync/dedupe, add agents.llmProvider + agents.llmModel.nnDoD:n- drizzle schema updatedn- drizzle-kit generates migrationn- migrations apply locally + remoten- typecheck + gate pass","notes":"Implemented new D1 schema: arenas→rooms, arena_agents→room_agents, added discord_channels (webhook per parent channel), updated messages (roomId/discordMessageId/threadId/authorType/createdAtMs), and added agents.llmProvider+llmModel. Updated ArenaService + worker code to use rooms+roomId and new message shape; DiscordWebhookPoster supports optional threadId (?thread_id=). Added custom migration migrations/0001_rooms_threads.sql (migrates existing data + drops old tables) and applied via wrangler to both --local and --remote. npm run gate passes.","status":"in_progress","priority":2,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-02-04T01:55:24.238008488+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-02-04T02:17:33.217718206+01:00","dependencies":[{"issue_id":"agon-3m6","depends_on_id":"agon-5oc","type":"blocks","created_at":"2026-02-04T01:56:22.482418586+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"agon-3m6","depends_on_id":"agon-1e3","type":"relates-to","created_at":"2026-02-04T01:57:16.717402761+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"agon-4rg","title":"Room settings: per-room auto-archive config (research + implement)","description":"Determine Discord thread auto-archive options supported by the API and model them as per-room config (store in DB). Apply the selected auto-archive duration when creating the thread.nnDoD:n- Document supported values (minutes) in design docn- Add room.autoArchiveDurationMinutes (or similar)n- Thread creation uses stored valuen- gate passes","status":"open","priority":2,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-02-04T01:55:44.646477161+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-02-04T01:55:44.646477161+01:00","dependencies":[{"issue_id":"agon-4rg","depends_on_id":"agon-04k","type":"blocks","created_at":"2026-02-04T01:56:42.817013427+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"agon-4rg","depends_on_id":"agon-3m6","type":"blocks","created_at":"2026-02-04T01:56:56.87787907+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"agon-4rg","depends_on_id":"agon-1e3","type":"relates-to","created_at":"2026-02-04T01:57:37.054935423+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"agon-5oc","title":"Design update: rooms/threads + per-agent provider routing","description":"Update docs/design.md to reflect final domain model: Rooms (threads), Agents (personas), room_agents membership, discord_channels webhook reuse, and turn loop using Discord thread history as source of truth.nnDoR:n- Epic agon-1e3 existsnnDoD:n- docs/design.md has: updated ERD, flow diagrams (text), webhook+thread_id strategy, idempotency story, and provider-per-agent routing descriptionn- Includes decisions + open questions for auto-archive duration values","notes":"Decisions: 1) Room == public thread under text channel (default). 2) History sync: include humans + our webhook messages; ignore other bots.","status":"closed","priority":2,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-02-04T01:55:19.151481722+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-02-04T02:07:55.870806264+01:00","closed_at":"2026-02-04T02:07:55.870806264+01:00","close_reason":"Updated docs/design.md: Room==public thread, webhook reuse per parent channel with thread_id posting, per-agent provider/model routing, Discord history as source of truth synced to D1, idempotent queue turns, and per-room auto-archive supported values.","dependencies":[{"issue_id":"agon-5oc","depends_on_id":"agon-1e3","type":"relates-to","created_at":"2026-02-04T01:57:11.632678325+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"agon-7fz","title":"LLM router: call provider/model per agent per turn","description":"Replace global LLM_PROVIDER selection with per-call routing. Add LlmRouter service that takes (provider, model, prompt) and uses @effect/ai Model.make + provider layers (openai/anthropic/google) to call LanguageModel.generateText.nnDoD:n- Can generate text for OpenAI + Anthropic + Gemini based on input provider/modeln- Arena/Room turn processing uses agent.llmProvider+llmModeln- Retries/timeouts preservedn- gate passes","status":"open","priority":2,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-02-04T01:55:29.324070465+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-02-04T01:55:29.324070465+01:00","dependencies":[{"issue_id":"agon-7fz","depends_on_id":"agon-3m6","type":"blocks","created_at":"2026-02-04T01:56:27.568016455+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"agon-7fz","depends_on_id":"agon-1e3","type":"relates-to","created_at":"2026-02-04T01:57:21.800787166+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"agon-81x","title":"History sync: fetch thread messages each turn and persist to D1","description":"On each turn, fetch last N messages from Discord thread, transform into prompt, and upsert into D1 messages table (dedupe by discord_message_id). Ensure bots filtering rules are applied and human interruptions are captured.nnDoD:n- Consumer uses Discord thread history as contextn- D1 persists synced history with dedupen- Prompt built from synced messages + agent system promptn- gate passes","status":"open","priority":2,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-02-04T01:55:39.564885055+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-02-04T01:55:39.564885055+01:00","dependencies":[{"issue_id":"agon-81x","depends_on_id":"agon-04k","type":"blocks","created_at":"2026-02-04T01:56:37.736475044+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"agon-81x","depends_on_id":"agon-3m6","type":"blocks","created_at":"2026-02-04T01:56:51.793360992+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"agon-81x","depends_on_id":"agon-7fz","type":"blocks","created_at":"2026-02-04T01:57:01.958303961+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"agon-81x","depends_on_id":"agon-1e3","type":"relates-to","created_at":"2026-02-04T01:57:31.964256914+01:00","created_by":"Rafał Krzyważnia"}]}
