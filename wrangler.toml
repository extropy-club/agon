name = "agon"
account_id = "2c42f4960f9c28a9235cac01483bd626"
main = "src/index.ts"
compatibility_date = "2025-09-08"
compatibility_flags = ["nodejs_compat"]

[[d1_databases]]
binding = "DB"
database_name = "agon-db"
database_id = "1b0fdea6-be60-4408-9e58-ca6f531ca126"

[[queues.producers]]
binding = "ARENA_QUEUE"
queue = "arena-turns"

[[queues.consumers]]
queue = "arena-turns"
max_batch_size = 1
max_retries = 3

[triggers]
crons = ["* * * * *"]

[vars]
# Non-secret defaults (override in .dev.vars / Wrangler secrets)
ARENA_MAX_TURNS = "30"
ARENA_HISTORY_LIMIT = "20"

# Used by the admin Metrics page (via /admin/meta) for deep links.
CF_ACCOUNT_ID = "2c42f4960f9c28a9235cac01483bd626"
CF_WORKER_SERVICE = "agon"
CF_QUEUE_NAME = "arena-turns"
CF_D1_NAME = "agon-db"

[dev]
port = 8787

[assets]
directory = "./packages/admin/dist"
binding = "ASSETS"

[[durable_objects.bindings]]
name = "TURN_AGENT"
class_name = "TurnAgent"

[[workflows]]
name = "turn-workflow"
binding = "TURN_WORKFLOW"
class_name = "TurnWorkflow"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["TurnAgent"]
